<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>TheBlog</title>
    <h:outputStylesheet name="css/style.css"/>
</h:head>

<h:body>
    <f:view>
        <ui:include src="./header.xhtml" />
        <b:container id="container">
            <h2 style="text-align: center; margin-top: 8px;">Posts</h2>
            <b:column col-sm="9" col-md="9" col-lg="10">
                <ui:fragment id="fragment"
                             rendered="#{indexController.posts != null and indexController.posts.size() > 0}">
                    <ui:repeat value="#{indexController.posts}" var="post">
                        <b:row>
                            <b:column col-md="11">
                                <b:well styleClass="small-padding">

                                    <div jsf:id="divTitle"
                                         style="font-weight: bolder; font-size: larger">
                                        <h:outputText value="#{post.title}"/>
                                    </div>
                                    <div jsf:id="divSubtitle">
                                        <h:outputText value="#{post.category.name}"/>
                                    </div>
                                    <hr/>
                                    <b:row>
                                        <b:column col-xs="1"
                                                  style="align-self: center; text-align: center">
                                            <h:form>
                                                <ui:fragment rendered="true">
                                                    <b:commandButton styleClass="buttonLink" tooltip="Upvote"
                                                                     update="tLikes" ajax="true"
                                                                     actionListener="#{indexController.upvotePost(post)}">
                                                        <b:iconAwesome value="caret-up" size="2x"
                                                                       styleClass="text-muted small-line-height"/>
                                                    </b:commandButton>
                                                </ui:fragment>
                                                <ui:fragment rendered="false">

                                                </ui:fragment>
                                                <div jsf:id="divLikes">
                                                    <h:outputText id="tLikes" value="#{post.likes}"/>
                                                </div>
                                                <ui:fragment rendered="true">
                                                    <b:commandButton styleClass="buttonLink buttonMargin" tooltip="Downvote"
                                                                     update="tLikes" tooltipPosition="right" ajax="true"
                                                                     actionListener="#{indexController.downvotePost(post)}">
                                                        <b:iconAwesome value="caret-down" size="2x"
                                                                       styleClass="text-muted small-line-height"/>
                                                    </b:commandButton>
                                                </ui:fragment>
                                                <ui:fragment rendered="false">

                                                </ui:fragment>
                                            </h:form>
                                        </b:column>
                                        <b:column col-xs="11">
                                            <div class="small-height">
                                            #{post.content}
                                            </div>
                                        </b:column>
                                    </b:row>
                                    <b:row>
                                        <b:column colSm="3">
                                            <b:button tooltip="Show Comments" tooltipPosition="right"
                                                      look="primary" outcome="#{post.postUrl}"
                                                      iconAwesome="fa-comments" class="icon"
                                                      style="margin-bottom: 5px;"/>
                                        </b:column>
                                        <b:column colSm="12" colMd="9" colLg="7"
                                                  style="display: flex">
                                            <div class="align-center">
                                                <ui:fragment rendered="#{!empty post.lastUpdatedAt}">
                                                    <div>
                                                        <div class="small">
                                                            <h:outputText
                                                                    value="Created #{post.createdAt.toString().substring(0, 10)}"/>
                                                        </div>
                                                        <div class="small">
                                                            <h:outputText
                                                                    value="Edited #{post.lastUpdatedAt.toString().substring(0, 10)}"/>
                                                        </div>
                                                    </div>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{empty post.lastUpdatedAt}">
                                                    <div class="small">
                                                        <h:outputText
                                                                value="Created #{post.createdAt.toString().substring(0, 10)}"/>
                                                    </div>
                                                </ui:fragment>
                                            </div>
                                            <div class="align-center">
                                                <b:iconAwesome value="user-circle" style="margin-right: 5px"
                                                               styleClass="pull-right" size="2x"/>
                                            </div>
                                            <div class="align-center">
                                                <h:outputText value="#{post.authorname}"/>
                                            </div>
                                        </b:column>
                                        <b:column colSm="12" colLg="2">
                                            <h:form>
                                                <b:commandButton tooltip="Edit Post" tooltipPosition="left"
                                                                 ajax="true" oncomplete="showModal1()" update=":form1"
                                                                 look="primary" iconAwesome="fa-pencil" class="icon"
                                                                 actionListener="#{indexController.setCurrentPost(post)}">
                                                </b:commandButton>#{" "}
                                                <b:commandButton
                                                        tooltip="Delete Post" tooltipPosition="right" ajax="true"
                                                        oncomplete="showModal2()" look="primary"
                                                        iconAwesome="fa-trash" class="icon"
                                                        actionListener="#{indexController.setCurrentPost(post)}"/>
                                            </h:form>
                                        </b:column>
                                    </b:row>
                                </b:well>
                            </b:column>
                        </b:row>
                    </ui:repeat>
                </ui:fragment>
            </b:column>
            <b:column col-sm="3" col-md="3" col-lg="2">
                <h3>Channels</h3>
                <h:form>
                    <p:selectOneButton value="#{indexController.filterOrder}" layout="pageDirection">
                        <f:selectItems value="#{indexController.categories}" var="category"
                                       itemLabel="#{category.name}" itemValue="#{category.name}" />
                        <p:ajax listener="#{indexController.filter}" update=":fragment"/>
                    </p:selectOneButton>
                </h:form>
                <hr/>
                <h3>Sort By</h3>
                <h:form>
                    <p:selectOneButton value="#{indexController.sortOrder}" layout="pageDirection">
                        <f:selectItem itemLabel="Newest" itemValue="newest"/>
                        <f:selectItem itemLabel="Best" itemValue="best"/>
                        <p:ajax listener="#{indexController.sort}" update=":fragment"/>
                    </p:selectOneButton>
                </h:form>
            </b:column>
        </b:container>
        <b:modal id="modal1" title="Edit Post" size="lg">
            <h:form id="form1">
                <b:inputText label="Titel:" labelStyle="width:80px;"
                             value="#{indexController.currentPost.title}"/>
                <b:inputTextarea label="Inhalt:" labelStyle="width:80px;"
                                 value="#{indexController.currentPost.content}"/>
            </h:form>
        </b:modal>
        <b:modal id="modal2" title="Confirmation" size="lg" closable="false">
            <h:outputText value="Do you really want to delete this post?"/>
            <f:facet name="footer">
                <h:form id="form2">
                    <b:button value="Cancel" dismiss="modal" look="primary" styleClass="btn-modal"/>
                    <b:commandButton value="OK" look="primary" styleClass="btn-modal"
                                     oncomplete="dismissModal2()" ajax="true" update=":container"
                                     actionListener="#{indexController.deletePost}"/>
                </h:form>
            </f:facet>
        </b:modal>
    </f:view>
    <script>
        function showModal1() {
            $('#modal1').modal('show');
        }

        function showModal2() {
            $('#modal2').modal('show');
        }

        function dismissModal2() {
            $('#modal2').modal('hide');
        }
    </script>
</h:body>
</html>
